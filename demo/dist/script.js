function v(_,f){return{method:_,args:f}}function W(_){return Object.fromEntries(_.split(/\s*,\s*/).map((f)=>{let[$,K]=f.split(/\s*=\s*/),A=K.replace(/^'|'$/g,"");if(!isNaN(A))A=Number(A);return[$,A]}))}function C(_){if(!/^GET\s+COLLECTIONS$/i.test(_))throw Error("Invalid GET COLLECTIONS syntax.");return v("getCollections",[])}function i(_){let f=_.match(/^CREATE\s+(?:TABLE|COLLECTION)\s+(IF\s+NOT\s+EXISTS\s+)?(\w+).*/i);if(!f)throw Error("Invalid CREATE TABLE/COLLECTION syntax.");return v("ensureCollection",[f[2]])}function z(_){let f=_.match(/^DROP\s+(?:TABLE|COLLECTION)\s+(?:IF\s+EXISTS\s+)?(\w+)$/i);if(!f)throw Error("Invalid DROP TABLE/COLLECTION syntax.");return v("removeCollection",[f[1]])}function e(_){let f=_.match(/^EXISTS\s+(?:TABLE|COLLECTION)\s+(\w+)$/i);if(!f)throw Error("Invalid EXISTS TABLE/COLLECTION syntax.");return v("issetCollection",[f[1]])}var U={"=":null,"<":"$lt",">":"$gt","<=":"$lte",">=":"$gte","!=":"$not",IN:"$in","NOT IN":"$nin"};function O(_,f){for(let $ in f)if($.startsWith("$"))_[$]=f[$];else if(_[$]!==void 0)if(typeof _[$]==="object"&&!Array.isArray(_[$]))Object.assign(_[$],f[$]);else _[$]=f[$];else _[$]=f[$]}function b(_){if(!_)return{};let f=_.trim();if(f===""||f==="1")return{};let $=_.replace(/\s+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/g," ").match(/(?:\(|\)|'[^']*'|"[^"]*"|[^\s()'"]+)/g)||[],K=[],A={},o=[],g=[];for(let w=0;w<$.length;w++){let n=$[w].trim();if(!n)continue;if(n==="(")K.push({current:A,operatorStack:o,stack:g}),A={},o=[],g=[];else if(n===")"){let G=A;if(g.length>0)g.push(A),G={$or:g};if(K.length===0)throw Error("Unmatched closing parenthesis");let Y=K.pop(),q=Y.current,P=Y.operatorStack,m=Y.stack;if(P.length>0){let j=P.pop();if(j==="OR")m.push(q),A=G;else if(j==="AND"){let r={};O(r,q),O(r,G),A=r}}else{let j={};O(j,q),O(j,G),A=j}o=Y.operatorStack,g=Y.stack}else if(n.toUpperCase()==="AND"||n.toUpperCase()==="OR")o.push(n.toUpperCase());else{if(o.length){if(o[o.length-1]==="OR")g.push(A),A={},o.pop()}let G=n;if(G.includes("."))G=G.split(".").pop();let Y=$[++w]?.trim(),q=$[++w]?.trim();if(!G||!Y||q===void 0)throw Error(`Invalid condition near '${G} ${Y} ${q}'`);if(q.startsWith("'")&&q.endsWith("'")||q.startsWith('"')&&q.endsWith('"'))q=q.slice(1,-1);if(!isNaN(Number(q)))q=Number(q);if(Y.toUpperCase()==="IN"||Y.toUpperCase()==="NOT IN"){if(!q.startsWith("(")||!q.endsWith(")"))throw Error(`Invalid syntax for '${Y}' near '${q}'`);q=q.slice(1,-1).split(",").map((m)=>{if(m=m.trim(),m.startsWith("'")&&m.endsWith("'")||m.startsWith('"')&&m.endsWith('"'))return m.slice(1,-1);return isNaN(Number(m))?m:Number(m)})}let P=U[Y.toUpperCase()];if(P!==void 0)if(P===null)A[G]=q;else{if(!A[P])A[P]={};A[P][G]=q}else A[G]=q}}if(g.length>0)return g.push(A),{$or:g};return A}function a(_){let f=_.match(/DELETE FROM ([\w\/]+)(?: WHERE (.+))?/i);if(!f)throw Error("Invalid DELETE syntax");let $=f[1],K=f[2]?b(f[2]):{};return v("remove",[$,K])}function k(_){let f=_.match(/INSERT INTO ([\w\/]+)\s*\(([^)]+)\)\s*VALUES\s*\(([^)]+)\)/i);if(!f)throw Error("Invalid INSERT syntax");let $=f[1],K=f[2].split(/\s*,\s*/);function A(n){let G=[],Y="",q=!1,P=!1;for(let m=0;m<n.length;m++){let j=n[m];if(j==="'"&&!P)q=!q,Y+=j;else if(j==='"'&&!q)P=!P,Y+=j;else if(j===","&&!q&&!P)G.push(Y),Y="";else Y+=j}return G.push(Y),G}let g=A(f[3]).map((n)=>{if(n=n.trim(),n.length>=2){if(n[0]==="'"&&n[n.length-1]==="'")n=n.substring(1,n.length-1);else if(n[0]==='"'&&n[n.length-1]==='"')n=n.substring(1,n.length-1)}return n});if(K.length!==g.length)throw Error("Number of columns and values does not match");let w=Object.fromEntries(K.map((n,G)=>[n,isNaN(g[G])?g[G]:Number(g[G])]));return v("add",[$,w])}class c{defaultDbKey;tableDbMap;knownForeignKeys=new Set;constructor(_,f){this.defaultDbKey=_,this.tableDbMap=f}identifyPkFk(_,f,$,K){let[A,o]=_.split("."),[g,w]=f.split(".");if(A===$)return{pk:_,fk:f};else if(g===$)return{pk:f,fk:_};if(K.has(_))return{pk:f,fk:_};else if(K.has(f))return{pk:_,fk:f};if(o==="id"||o==="_id")return{pk:_,fk:f};else if(w==="id"||w==="_id")return{pk:f,fk:_};throw Error(`Cannot determine pk/fk from condition: "${_} = ${f}"`)}buildRelations(_,f){let $={},K=new Set(this.knownForeignKeys);for(let[A,o]of Object.entries(_)){let[g,w]=o.split(/\s*=\s*/),{pk:n,fk:G}=this.identifyPkFk(g,w,f,K),[Y,q]=n.split("."),[P,m]=G.split(".");K.add(G);let j=this.tableDbMap?.[P]||this.defaultDbKey;$[A]={type:"1n",path:[j,P],pk:q,fk:m,as:A}}return this.knownForeignKeys=K,$}}function t(_,f){let $,K=_,A=_.toUpperCase().lastIndexOf(" WHERE ");if(A!==-1)$=_.substring(A+7).trim(),K=_.substring(0,A);let o=K.match(/SELECT\s+(.+?)\s+FROM\s+([\w\/]+)((?:\s+JOIN\s+.+)*)?/i);if(!o)throw Error("Invalid SELECT syntax");let g=o[1].trim(),w=o[2],n=o[3]||"",G=$?b($):{},Y=__(g);if(n&&f?.defaultDbKey){let q=Q(n),m=new c(f.defaultDbKey,f.tableDbMap).buildRelations(q,w),j=[f.defaultDbKey,w];return v("relation-find",[j,G,m,Y])}return v("find",[w,G,{},Y])}function Q(_){let f={},$=/\s+JOIN\s+([\w\/]+)(?:\s+AS\s+)?([\w\/]+)?\s+ON\s+([^\s]+)\s*=\s*([^\s]+)/gi,K;while((K=$.exec(_))!==null){let A=K[1],o=K[2]||A,g=`${K[3]} = ${K[4]}`;f[o]=g}return f}function __(_){if(_=_.trim(),_==="*")return{};let f=_.match(/\*\s+EXCLUDE\s+(.+)/i);if(f)return{exclude:f[1].split(/\s*,\s*/)};return{select:_.split(/\s*,\s*/)}}function T(_){let f=_.match(/UPDATE\s+([\w\/]+)\s+SET\s+(.+)\s+WHERE\s+(.+)/i);if(!f)throw Error("Invalid UPDATE syntax");let $=f[1],K=W(f[2]),A=b(f[3]);return v("update",[$,A,K])}class l{parse(_,f){if(_=_.replace(/\s+/g," ").trim(),_.endsWith(";"))_=_.slice(0,-1);let $=_.split(/\s+/),K=$[0].toUpperCase();if(K==="SELECT")return t(_,f);else if(K==="INSERT")return k(_);else if(K==="UPDATE")return T(_);else if(K==="DELETE")return a(_);else if(K==="GET")return C(_);else if(K==="CREATE")return i(_);else if(K==="DROP")return z(_);else if(K==="EXISTS")return e(_);else throw Error("Unknown query: "+$[0])}}var J=l;function V(_,f){let{args:$,method:K}=_,A=$[0],o={db:f,d:{}},g={find:{options:$[2],searchOpts:$[3]},findOne:{searchOpts:$[2]},update:{updater:$[2]},updateOne:{updater:$[2]},add:{data:$[1]}};if(o.d={[K]:g[K]||{}},o.d[K].collection=A,K!=="add")o.d[K].search=$[1];return o}function M(_){let{args:f}=_;return{r:{path:f[0],search:f[1],relations:f[2],options:f[3],select:f[4],many:!0}}}function I(_,f=""){let $=[];for(let K in _)if(_.hasOwnProperty(K)){let A=_[K],o=f?`${f}.${K}`:K;if(typeof A==="object"&&A!==null&&!Array.isArray(A))$.push(...I(A,o).split(" ").filter((g)=>g.length>0));else if(Array.isArray(A))$.push(`${o}=${JSON.stringify(A)}`);else $.push(`${o}=${A}`)}return $.join(" ")}function X(_,f,$){if(!(f in _))return;_[$]=_[f],delete _[f]}function H(_){let f="";if(!("d"in _))return"Relation cannot be converted to VQLS";let $=_.d,K=Object.keys($)[0],A=$[K],o=A.collection,g=K.replace("One","");if(g==="find");else if(g==="update")o="~"+o;else if(g==="remove")o="-"+o;else if(g==="add")o="+"+o;else if(K==="updateOneOrAdd")o="updateOneOrAdd "+o;if(K.endsWith("One"))o+="!";if(delete A.collection,X(A,"search","s"),X(A,"data","d"),X(A,"options","o"),X(A,"updater","u"),A.searchOpts?.select)A.select=A.searchOpts.select.reduce((n,G)=>{return n[G]=1,n},{}),delete A.searchOpts.select;X(A,"select","e");let w=I(A);return f+=`${_.db} ${o} ${w}`,f}var f_=new J;function y(_,f,$=!1,K={}){let A=f_.parse(_,{defaultDbKey:f});K.dbData=A;let o=A.method==="relation-find"?M(A):V(A,f);return $?H(o):o}var E=document.querySelector("#sql-input"),x=document.querySelector("#db-name"),s=document.querySelector("#translate-btn"),Z=document.querySelector("#vql-object"),u=document.querySelector("#vql-string"),R=document.querySelector("#copy-vql"),N=document.querySelector("#copy-string"),d=document.querySelector("#output-card"),p="",h="",S=document.querySelectorAll(".tab-link"),$_=document.querySelectorAll(".tab-pane");S.forEach((_)=>{_.addEventListener("click",()=>{S.forEach(($)=>$.classList.remove("active")),$_.forEach(($)=>$.classList.remove("active")),_.classList.add("active");let f=document.querySelector(`#${_.dataset.tab}`);if(f)f.classList.add("active")})});function L(){let _=E.value.trim(),f=x.value.trim()||"db1";if(!_){Z.textContent="Please enter a SQL query.",u.textContent="",d.classList.add("hidden");return}try{let $={},K=y(_,f,!1,$);console.log($),console.log(K),p=JSON.stringify(K,null,2),Z.textContent=p;let A=H(K);h=A,u.textContent=h,console.log(A),console.log("----"),d.classList.remove("hidden")}catch($){console.error("Translation error:",$);let K=$ instanceof Error?$.message:"An unknown error occurred.";p=`Error: ${K}`,h=`Error: ${K}`,Z.textContent=p,u.textContent=h,d.classList.remove("hidden")}}s.addEventListener("click",L);function B(_){if(_.key==="Enter"&&!_.shiftKey)_.preventDefault(),s.click()}E.addEventListener("keydown",B);x.addEventListener("keydown",B);var D;function F(_){let f=_.closest(".result-box");if(!f)return;let $=f.querySelector(".copy-tooltip");if(!$)return;clearTimeout(D),$.classList.add("visible"),D=setTimeout(()=>{$.classList.remove("visible")},1500)}R.addEventListener("click",()=>{if(!p)return;navigator.clipboard.writeText(p),F(R)});N.addEventListener("click",()=>{if(!h)return;navigator.clipboard.writeText(h),F(N)});L();

//# debugId=41AE7A7008939A1264756E2164756E21
//# sourceMappingURL=script.js.map
