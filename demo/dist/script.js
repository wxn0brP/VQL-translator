function v(_,$){return{method:_,args:$}}function H(_){return Object.fromEntries(_.split(/\s*,\s*/).map(($)=>{let[A,K]=$.split(/\s*=\s*/),f=K.replace(/^'|'$/g,"");if(!isNaN(f))f=Number(f);return[A,f]}))}var y={"=":null,"<":"$lt",">":"$gt","<=":"$lte",">=":"$gte","!=":"$not",IN:"$in","NOT IN":"$nin"};function Z(_,$){for(let A in $)if(A.startsWith("$"))_[A]=$[A];else if(_[A]!==void 0)if(typeof _[A]==="object"&&!Array.isArray(_[A]))Object.assign(_[A],$[A]);else _[A]=$[A];else _[A]=$[A]}function n(_){if(!_)return{};let $=_.trim();if($===""||$==="1")return{};let A=_.replace(/\s+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/g," ").match(/(?:\(|\)|'[^']*'|"[^"]*"|[^\s()'"]+)/g)||[],K=[],f={},q=[],g=[];for(let I=0;I<A.length;I++){let G=A[I].trim();if(!G)continue;if(G==="(")K.push({current:f,operatorStack:q,stack:g}),f={},q=[],g=[];else if(G===")"){let j=f;if(g.length>0)g.push(f),j={$or:g};if(K.length===0)throw Error("Unmatched closing parenthesis");let w=K.pop(),Y=w.current,X=w.operatorStack,P=w.stack;if(X.length>0){let m=X.pop();if(m==="OR")P.push(Y),f=j;else if(m==="AND"){let W={};Z(W,Y),Z(W,j),f=W}}else{let m={};Z(m,Y),Z(m,j),f=m}q=w.operatorStack,g=w.stack}else if(G.toUpperCase()==="AND"||G.toUpperCase()==="OR")q.push(G.toUpperCase());else{if(q.length){if(q[q.length-1]==="OR")g.push(f),f={},q.pop()}let j=G,w=A[++I]?.trim(),Y=A[++I]?.trim();if(!j||!w||Y===void 0)throw Error(`Invalid condition near '${j} ${w} ${Y}'`);if(Y.startsWith("'")&&Y.endsWith("'")||Y.startsWith('"')&&Y.endsWith('"'))Y=Y.slice(1,-1);if(!isNaN(Number(Y)))Y=Number(Y);if(w.toUpperCase()==="IN"||w.toUpperCase()==="NOT IN"){if(!Y.startsWith("(")||!Y.endsWith(")"))throw Error(`Invalid syntax for '${w}' near '${Y}'`);Y=Y.slice(1,-1).split(",").map((P)=>{if(P=P.trim(),P.startsWith("'")&&P.endsWith("'")||P.startsWith('"')&&P.endsWith('"'))return P.slice(1,-1);return isNaN(Number(P))?P:Number(P)})}let X=y[w.toUpperCase()];if(X!==void 0)if(X===null)f[j]=Y;else{if(!f[X])f[X]={};f[X][j]=Y}else f[j]=Y}}if(g.length>0)return g.push(f),{$or:g};return f}function O(_){let $=_.match(/SELECT\s+(.+?)\s+FROM\s+([\w\/]+)(?:\s+WHERE\s+(.+))?/i);if(!$)throw Error("Invalid SELECT syntax");let A=$[1].trim(),K=$[2],f=$[3]?n($[3]):{},q=S(A);return v("find",[K,f,{},q])}function S(_){if(_=_.trim(),_==="*")return{};let $=_.match(/\*\s+EXCLUDE\s+(.+)/i);if($)return{exclude:$[1].split(/\s*,\s*/)};return{select:_.split(/\s*,\s*/)}}function p(_){let $=_.match(/INSERT INTO ([\w\/]+)\s*\(([^)]+)\)\s*VALUES\s*\(([^)]+)\)/i);if(!$)throw Error("Invalid INSERT syntax");let A=$[1],K=$[2].split(/\s*,\s*/);function f(G){let j=[],w="",Y=!1,X=!1;for(let P=0;P<G.length;P++){let m=G[P];if(m==="'"&&!X)Y=!Y,w+=m;else if(m==='"'&&!Y)X=!X,w+=m;else if(m===","&&!Y&&!X)j.push(w),w="";else w+=m}return j.push(w),j}let g=f($[3]).map((G)=>{if(G=G.trim(),G.length>=2){if(G[0]==="'"&&G[G.length-1]==="'")G=G.substring(1,G.length-1);else if(G[0]==='"'&&G[G.length-1]==='"')G=G.substring(1,G.length-1)}return G});if(K.length!==g.length)throw Error("Number of columns and values does not match");let I=Object.fromEntries(K.map((G,j)=>[G,isNaN(g[j])?g[j]:Number(g[j])]));return v("add",[A,I])}function C(_){let $=_.match(/UPDATE\s+([\w\/]+)\s+SET\s+(.+)\s+WHERE\s+(.+)/i);if(!$)throw Error("Invalid UPDATE syntax");let A=$[1],K=H($[2]),f=n($[3]);return v("update",[A,f,K])}function z(_){let $=_.match(/DELETE FROM ([\w\/]+)(?: WHERE (.+))?/i);if(!$)throw Error("Invalid DELETE syntax");let A=$[1],K=$[2]?n($[2]):{};return v("remove",[A,K])}function i(_){if(!/^GET\s+COLLECTIONS$/i.test(_))throw Error("Invalid GET COLLECTIONS syntax.");return v("getCollections",[])}function d(_){let $=_.match(/^CREATE\s+(?:TABLE|COLLECTION)\s+(IF\s+NOT\s+EXISTS\s+)?(\w+).*/i);if(!$)throw Error("Invalid CREATE TABLE/COLLECTION syntax.");return v("ensureCollection",[$[2]])}function o(_){let $=_.match(/^DROP\s+(?:TABLE|COLLECTION)\s+(?:IF\s+EXISTS\s+)?(\w+)$/i);if(!$)throw Error("Invalid DROP TABLE/COLLECTION syntax.");return v("removeCollection",[$[1]])}function u(_){let $=_.match(/^EXISTS\s+(?:TABLE|COLLECTION)\s+(\w+)$/i);if(!$)throw Error("Invalid EXISTS TABLE/COLLECTION syntax.");return v("issetCollection",[$[1]])}class k{parse(_){_=_.replace(/\s+/g," ").trim();let $=_.split(/\s+/),A=$[0].toUpperCase();if(A==="SELECT")return O(_);else if(A==="INSERT")return p(_);else if(A==="UPDATE")return C(_);else if(A==="DELETE")return z(_);else if(A==="GET")return i(_);else if(A==="CREATE")return d(_);else if(A==="DROP")return o(_);else if(A==="EXISTS")return u(_);else throw Error("Unknown query: "+$[0])}}var T=k;var N=new T;function E(_,$){let{args:A,method:K}=_,f=A[0],q={db:$,d:{}},g={find:{options:A[2],searchOpts:A[3]},findOne:{searchOpts:A[2]},update:{updater:A[2]},updateOne:{updater:A[2]},add:{data:A[1]}};if(q.d={[K]:g[K]||{}},q.d[K].collection=f,K!=="add")q.d[K].search=A[1];return q}function c(_,$=""){let A=[];for(let K in _)if(_.hasOwnProperty(K)){let f=_[K],q=$?`${$}.${K}`:K;if(typeof f==="object"&&f!==null&&!Array.isArray(f))A.push(...c(f,q).split(" ").filter((g)=>g.length>0));else A.push(`${q}=${f}`)}return A.join(" ")}function h(_){let $="";if(!("d"in _))throw Error("Not implemented yet");let A=_.d,K=Object.keys(A)[0],f=A[K],q=f.collection,g=K.replace("One","");if(g==="find");else if(g==="update")q="~"+q;else if(g==="remove")q="-"+q;else if(g==="add")q="+"+q;else if(K==="updateOneOrAdd")q="updateOneOrAdd "+q;if(K.endsWith("One"))q+="!";if(delete f.collection,b(f,"search","s"),b(f,"data","d"),b(f,"options","o"),b(f,"updater","u"),f.searchOpts?.select)f.select=f.searchOpts.select.reduce((G,j)=>{return G[j]=1,G}),delete f.searchOpts.select;b(f,"select","e");let I=c(f);return $+=`${_.db} ${q} ${I}`,$}function b(_,$,A){if(!($ in _))return;_[A]=_[$],delete _[$]}function J(_,$,A=!1){let K=N.parse(_),f=E(K,$);return A?h(f):f}var a=document.querySelector("#sql-input"),V=document.querySelector("#db-name"),R=document.querySelector("#translate-btn"),l=document.querySelector("#vql-object"),r=document.querySelector("#vql-string"),t="",M="";R.addEventListener("click",()=>{let _=a.value.trim(),$=V.value.trim()||"db1";if(!_){alert("Please enter a SQL query");return}try{let A=J(_,$,!1);l.textContent=t=JSON.stringify(A,null,2);let K=h(A);r.textContent=M=K}catch(A){console.error("Translation error:",A),l.textContent=`Error: ${A.message}`,r.textContent=`Error: ${A.message}`}});function e(_){if(_.key==="Enter")R.click()}a.addEventListener("keydown",e);V.addEventListener("keydown",e);document.querySelector("#copy-vql").addEventListener("click",()=>{navigator.clipboard.writeText(t),alert("VQL object copied to clipboard")});document.querySelector("#copy-string").addEventListener("click",()=>{navigator.clipboard.writeText(M),alert("VQL string copied to clipboard")});

//# debugId=829D88F99057B7B364756E2164756E21
//# sourceMappingURL=script.js.map
