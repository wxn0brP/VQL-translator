function H(A,$){return{method:A,args:$}}function z(A){return Object.fromEntries(A.split(/\s*,\s*/).map(($)=>{let[_,f]=$.split(/\s*=\s*/),K=f.replace(/^'|'$/g,"");if(!isNaN(K))K=Number(K);return[_,K]}))}function d(A){if(!/^GET\s+COLLECTIONS$/i.test(A))throw Error("Invalid GET COLLECTIONS syntax.");return H("getCollections",[])}function c(A){let $=A.match(/^CREATE\s+(?:TABLE|COLLECTION)\s+(IF\s+NOT\s+EXISTS\s+)?(\w+).*/i);if(!$)throw Error("Invalid CREATE TABLE/COLLECTION syntax.");return H("ensureCollection",[$[2]])}function k(A){let $=A.match(/^DROP\s+(?:TABLE|COLLECTION)\s+(?:IF\s+EXISTS\s+)?(\w+)$/i);if(!$)throw Error("Invalid DROP TABLE/COLLECTION syntax.");return H("removeCollection",[$[1]])}function r(A){let $=A.match(/^EXISTS\s+(?:TABLE|COLLECTION)\s+(\w+)$/i);if(!$)throw Error("Invalid EXISTS TABLE/COLLECTION syntax.");return H("issetCollection",[$[1]])}var B={"=":null,"<":"$lt",">":"$gt","<=":"$lte",">=":"$gte","!=":"$not",IN:"$in","NOT IN":"$nin"};function h(A,$){for(let _ in $)if(_.startsWith("$"))A[_]=$[_];else if(A[_]!==void 0)if(typeof A[_]==="object"&&!Array.isArray(A[_]))Object.assign(A[_],$[_]);else A[_]=$[_];else A[_]=$[_]}function b(A){if(!A)return{};let $=A.trim();if($===""||$==="1")return{};let _=A.replace(/\s+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/g," ").match(/(?:\(|\)|'[^']*'|"[^"]*"|[^\s()'"]+)/g)||[],f=[],K={},q=[],Y=[];for(let j=0;j<_.length;j++){let G=_[j].trim();if(!G)continue;if(G==="(")f.push({current:K,operatorStack:q,stack:Y}),K={},q=[],Y=[];else if(G===")"){let g=K;if(Y.length>0)Y.push(K),g={$or:Y};if(f.length===0)throw Error("Unmatched closing parenthesis");let w=f.pop(),P=w.current,v=w.operatorStack,m=w.stack;if(v.length>0){let X=v.pop();if(X==="OR")m.push(P),K=g;else if(X==="AND"){let O={};h(O,P),h(O,g),K=O}}else{let X={};h(X,P),h(X,g),K=X}q=w.operatorStack,Y=w.stack}else if(G.toUpperCase()==="AND"||G.toUpperCase()==="OR")q.push(G.toUpperCase());else{if(q.length){if(q[q.length-1]==="OR")Y.push(K),K={},q.pop()}let g=G;if(g.includes("."))g=g.split(".").pop();let w=_[++j]?.trim(),P=_[++j]?.trim();if(!g||!w||P===void 0)throw Error(`Invalid condition near '${g} ${w} ${P}'`);if(P.startsWith("'")&&P.endsWith("'")||P.startsWith('"')&&P.endsWith('"'))P=P.slice(1,-1);if(!isNaN(Number(P)))P=Number(P);if(w.toUpperCase()==="IN"||w.toUpperCase()==="NOT IN"){if(!P.startsWith("(")||!P.endsWith(")"))throw Error(`Invalid syntax for '${w}' near '${P}'`);P=P.slice(1,-1).split(",").map((m)=>{if(m=m.trim(),m.startsWith("'")&&m.endsWith("'")||m.startsWith('"')&&m.endsWith('"'))return m.slice(1,-1);return isNaN(Number(m))?m:Number(m)})}let v=B[w.toUpperCase()];if(v!==void 0)if(v===null)K[g]=P;else{if(!K[v])K[v]={};K[v][g]=P}else K[g]=P}}if(Y.length>0)return Y.push(K),{$or:Y};return K}function i(A){let $=A.match(/DELETE FROM ([\w\/]+)(?: WHERE (.+))?/i);if(!$)throw Error("Invalid DELETE syntax");let _=$[1],f=$[2]?b($[2]):{};return H("remove",[_,f])}function T(A){let $=A.match(/INSERT INTO ([\w\/]+)\s*\(([^)]+)\)\s*VALUES\s*\(([^)]+)\)/i);if(!$)throw Error("Invalid INSERT syntax");let _=$[1],f=$[2].split(/\s*,\s*/);function K(G){let g=[],w="",P=!1,v=!1;for(let m=0;m<G.length;m++){let X=G[m];if(X==="'"&&!v)P=!P,w+=X;else if(X==='"'&&!P)v=!v,w+=X;else if(X===","&&!P&&!v)g.push(w),w="";else w+=X}return g.push(w),g}let Y=K($[3]).map((G)=>{if(G=G.trim(),G.length>=2){if(G[0]==="'"&&G[G.length-1]==="'")G=G.substring(1,G.length-1);else if(G[0]==='"'&&G[G.length-1]==='"')G=G.substring(1,G.length-1)}return G});if(f.length!==Y.length)throw Error("Number of columns and values does not match");let j=Object.fromEntries(f.map((G,g)=>[G,isNaN(Y[g])?Y[g]:Number(Y[g])]));return H("add",[_,j])}class W{defaultDbKey;tableDbMap;knownForeignKeys=new Set;constructor(A,$){this.defaultDbKey=A,this.tableDbMap=$}identifyPkFk(A,$,_,f){let[K,q]=A.split("."),[Y,j]=$.split("."),G=`${K}.${q}`,g=`${Y}.${j}`;if(f.has(G))return{pk:$,fk:A};else if(f.has(g))return{pk:A,fk:$};if(q==="id"||q==="_id")return{pk:A,fk:$};else if(j==="id"||j==="_id")return{pk:$,fk:A};if(K===_)return{pk:A,fk:$};else if(Y===_)return{pk:$,fk:A};throw Error(`Cannot determine pk/fk from condition: "${A} = ${$}"`)}buildRelations(A,$){let _={},f=new Set(this.knownForeignKeys);for(let[K,q]of Object.entries(A)){let[Y,j]=q.split(/\s*=\s*/),{pk:G,fk:g}=this.identifyPkFk(Y,j,$,f),[w,P]=G.split("."),[v,m]=g.split(".");f.add(`${v}.${m}`);let X=this.tableDbMap?.[v]||this.defaultDbKey;_[K]={type:"1n",path:[X,v],pk:P,fk:m,as:K}}return this.knownForeignKeys=f,_}}function J(A,$){let _,f=A,K=A.toUpperCase().lastIndexOf(" WHERE ");if(K!==-1)_=A.substring(K+7).trim(),f=A.substring(0,K);let q=f.match(/SELECT\s+(.+?)\s+FROM\s+([\w\/]+)((?:\s+JOIN\s+.+)*)?/i);if(!q)throw Error("Invalid SELECT syntax");let Y=q[1].trim(),j=q[2],G=q[3]||"",g=_?b(_):{},w=U(Y);if(G&&$?.defaultDbKey){let P=F(G),m=new W($.defaultDbKey,$.tableDbMap).buildRelations(P,j),X=[$.defaultDbKey,j];return H("relation-find",[X,g,m,w])}return H("find",[j,g,{},w])}function F(A){let $={},_=/\s+JOIN\s+([\w\/]+)(?:\s+AS\s+)?([\w\/]+)?\s+ON\s+([^\s]+)\s*=\s*([^\s]+)/gi,f;while((f=_.exec(A))!==null){let K=f[1],q=f[2]||K,Y=`${f[3]} = ${f[4]}`;$[q]=Y}return $}function U(A){if(A=A.trim(),A==="*")return{};let $=A.match(/\*\s+EXCLUDE\s+(.+)/i);if($)return{exclude:$[1].split(/\s*,\s*/)};return{select:A.split(/\s*,\s*/)}}function a(A){let $=A.match(/UPDATE\s+([\w\/]+)\s+SET\s+(.+)\s+WHERE\s+(.+)/i);if(!$)throw Error("Invalid UPDATE syntax");let _=$[1],f=z($[2]),K=b($[3]);return H("update",[_,K,f])}class l{parse(A,$){A=A.replace(/\s+/g," ").trim();let _=A.split(/\s+/),f=_[0].toUpperCase();if(f==="SELECT")return J(A,$);else if(f==="INSERT")return T(A);else if(f==="UPDATE")return a(A);else if(f==="DELETE")return i(A);else if(f==="GET")return d(A);else if(f==="CREATE")return c(A);else if(f==="DROP")return k(A);else if(f==="EXISTS")return r(A);else throw Error("Unknown query: "+_[0])}}var V=l;var Q=new V;function AA(A,$){let{args:_,method:f}=A,K=_[0],q={db:$,d:{}},Y={find:{options:_[2],searchOpts:_[3]},findOne:{searchOpts:_[2]},update:{updater:_[2]},updateOne:{updater:_[2]},add:{data:_[1]}};if(q.d={[f]:Y[f]||{}},q.d[f].collection=K,f!=="add")q.d[f].search=_[1];return q}function t(A,$=""){let _=[];for(let f in A)if(A.hasOwnProperty(f)){let K=A[f],q=$?`${$}.${f}`:f;if(typeof K==="object"&&K!==null&&!Array.isArray(K))_.push(...t(K,q).split(" ").filter((Y)=>Y.length>0));else if(Array.isArray(K))_.push(`${q}=${JSON.stringify(K)}`);else _.push(`${q}=${K}`)}return _.join(" ")}function o(A){let $="";if(!("d"in A))return"Relation cannot be converted to VQLS";let _=A.d,f=Object.keys(_)[0],K=_[f],q=K.collection,Y=f.replace("One","");if(Y==="find");else if(Y==="update")q="~"+q;else if(Y==="remove")q="-"+q;else if(Y==="add")q="+"+q;else if(f==="updateOneOrAdd")q="updateOneOrAdd "+q;if(f.endsWith("One"))q+="!";if(delete K.collection,Z(K,"search","s"),Z(K,"data","d"),Z(K,"options","o"),Z(K,"updater","u"),K.searchOpts?.select)K.select=K.searchOpts.select.reduce((G,g)=>{return G[g]=1,G},{}),delete K.searchOpts.select;Z(K,"select","e");let j=t(K);return $+=`${A.db} ${q} ${j}`,$}function Z(A,$,_){if(!($ in A))return;A[_]=A[$],delete A[$]}function $A(A){let{args:$}=A;return{r:{path:$[0],search:$[1],relations:$[2],options:$[3],select:$[4],many:!0}}}function e(A,$,_=!1){let f=Q.parse(A,{defaultDbKey:$}),K=f.method==="relation-find"?$A(f):AA(f,$);return _?o(K):K}var S=document.querySelector("#sql-input"),D=document.querySelector("#db-name"),E=document.querySelector("#translate-btn"),p=document.querySelector("#vql-object"),C=document.querySelector("#vql-string"),M=document.querySelector("#copy-vql"),R=document.querySelector("#copy-string"),u=document.querySelector("#output-card"),n="",I="",y=document.querySelectorAll(".tab-link"),_A=document.querySelectorAll(".tab-pane");y.forEach((A)=>{A.addEventListener("click",()=>{y.forEach((_)=>_.classList.remove("active")),_A.forEach((_)=>_.classList.remove("active")),A.classList.add("active");let $=document.querySelector(`#${A.dataset.tab}`);if($)$.classList.add("active")})});function x(){let A=S.value.trim(),$=D.value.trim()||"db1";if(!A){p.textContent="Please enter a SQL query.",C.textContent="",u.classList.add("hidden");return}try{let _=e(A,$,!1);n=JSON.stringify(_,null,2),p.textContent=n,I=o(_),C.textContent=I,u.classList.remove("hidden")}catch(_){console.error("Translation error:",_);let f=_ instanceof Error?_.message:"An unknown error occurred.";n=`Error: ${f}`,I=`Error: ${f}`,p.textContent=n,C.textContent=I,u.classList.remove("hidden")}}E.addEventListener("click",x);function L(A){if(A.key==="Enter"&&!A.shiftKey)A.preventDefault(),E.click()}S.addEventListener("keydown",L);D.addEventListener("keydown",L);var N;function s(A){let $=A.closest(".result-box");if(!$)return;let _=$.querySelector(".copy-tooltip");if(!_)return;clearTimeout(N),_.classList.add("visible"),N=setTimeout(()=>{_.classList.remove("visible")},1500)}M.addEventListener("click",()=>{if(!n)return;navigator.clipboard.writeText(n),s(M)});R.addEventListener("click",()=>{if(!I)return;navigator.clipboard.writeText(I),s(R)});x();

//# debugId=A718DA795505757264756E2164756E21
//# sourceMappingURL=script.js.map
