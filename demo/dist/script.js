function v(_,$){return{method:_,args:$}}function d(_){return Object.fromEntries(_.split(/\s*,\s*/).map(($)=>{let[f,K]=$.split(/\s*=\s*/),A=K.replace(/^'|'$/g,"");if(!isNaN(A))A=Number(A);return[f,A]}))}function C(_){if(!/^GET\s+COLLECTIONS$/i.test(_))throw Error("Invalid GET COLLECTIONS syntax.");return v("getCollections",[])}function i(_){let $=_.match(/^CREATE\s+(?:TABLE|COLLECTION)\s+(IF\s+NOT\s+EXISTS\s+)?(\w+).*/i);if(!$)throw Error("Invalid CREATE TABLE/COLLECTION syntax.");return v("ensureCollection",[$[2]])}function z(_){let $=_.match(/^DROP\s+(?:TABLE|COLLECTION)\s+(?:IF\s+EXISTS\s+)?(\w+)$/i);if(!$)throw Error("Invalid DROP TABLE/COLLECTION syntax.");return v("removeCollection",[$[1]])}function e(_){let $=_.match(/^EXISTS\s+(?:TABLE|COLLECTION)\s+(\w+)$/i);if(!$)throw Error("Invalid EXISTS TABLE/COLLECTION syntax.");return v("issetCollection",[$[1]])}var U={"=":null,"<":"$lt",">":"$gt","<=":"$lte",">=":"$gte","!=":"$not",IN:"$in","NOT IN":"$nin"};function O(_,$){for(let f in $)if(f.startsWith("$"))_[f]=$[f];else if(_[f]!==void 0)if(typeof _[f]==="object"&&!Array.isArray(_[f]))Object.assign(_[f],$[f]);else _[f]=$[f];else _[f]=$[f]}function b(_){if(!_)return{};let $=_.trim();if($===""||$==="1")return{};let f=_.replace(/\s+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/g," ").match(/(?:\(|\)|'[^']*'|"[^"]*"|[^\s()'"]+)/g)||[],K=[],A={},n=[],g=[];for(let w=0;w<f.length;w++){let o=f[w].trim();if(!o)continue;if(o==="(")K.push({current:A,operatorStack:n,stack:g}),A={},n=[],g=[];else if(o===")"){let G=A;if(g.length>0)g.push(A),G={$or:g};if(K.length===0)throw Error("Unmatched closing parenthesis");let Y=K.pop(),q=Y.current,P=Y.operatorStack,m=Y.stack;if(P.length>0){let j=P.pop();if(j==="OR")m.push(q),A=G;else if(j==="AND"){let H={};O(H,q),O(H,G),A=H}}else{let j={};O(j,q),O(j,G),A=j}n=Y.operatorStack,g=Y.stack}else if(o.toUpperCase()==="AND"||o.toUpperCase()==="OR")n.push(o.toUpperCase());else{if(n.length){if(n[n.length-1]==="OR")g.push(A),A={},n.pop()}let G=o;if(G.includes("."))G=G.split(".").pop();let Y=f[++w]?.trim(),q=f[++w]?.trim();if(!G||!Y||q===void 0)throw Error(`Invalid condition near '${G} ${Y} ${q}'`);if(q.startsWith("'")&&q.endsWith("'")||q.startsWith('"')&&q.endsWith('"'))q=q.slice(1,-1);if(!isNaN(Number(q)))q=Number(q);if(Y.toUpperCase()==="IN"||Y.toUpperCase()==="NOT IN"){if(!q.startsWith("(")||!q.endsWith(")"))throw Error(`Invalid syntax for '${Y}' near '${q}'`);q=q.slice(1,-1).split(",").map((m)=>{if(m=m.trim(),m.startsWith("'")&&m.endsWith("'")||m.startsWith('"')&&m.endsWith('"'))return m.slice(1,-1);return isNaN(Number(m))?m:Number(m)})}let P=U[Y.toUpperCase()];if(P!==void 0)if(P===null)A[G]=q;else{if(!A[P])A[P]={};A[P][G]=q}else A[G]=q}}if(g.length>0)return g.push(A),{$or:g};return A}function a(_){let $=_.match(/DELETE FROM ([\w\/]+)(?: WHERE (.+))?/i);if(!$)throw Error("Invalid DELETE syntax");let f=$[1],K=$[2]?b($[2]):{};return v("remove",[f,K])}function k(_){let $=_.match(/INSERT INTO ([\w\/]+)\s*\(([^)]+)\)\s*VALUES\s*\(([^)]+)\)/i);if(!$)throw Error("Invalid INSERT syntax");let f=$[1],K=$[2].split(/\s*,\s*/);function A(o){let G=[],Y="",q=!1,P=!1;for(let m=0;m<o.length;m++){let j=o[m];if(j==="'"&&!P)q=!q,Y+=j;else if(j==='"'&&!q)P=!P,Y+=j;else if(j===","&&!q&&!P)G.push(Y),Y="";else Y+=j}return G.push(Y),G}let g=A($[3]).map((o)=>{if(o=o.trim(),o.length>=2){if(o[0]==="'"&&o[o.length-1]==="'")o=o.substring(1,o.length-1);else if(o[0]==='"'&&o[o.length-1]==='"')o=o.substring(1,o.length-1)}return o});if(K.length!==g.length)throw Error("Number of columns and values does not match");let w=Object.fromEntries(K.map((o,G)=>[o,isNaN(g[G])?g[G]:Number(g[G])]));return v("add",[f,w])}class I{defaultDbKey;tableDbMap;knownForeignKeys=new Set;constructor(_,$){this.defaultDbKey=_,this.tableDbMap=$}identifyPkFk(_,$,f,K){let[A,n]=_.split("."),[g,w]=$.split("."),o=`${A}.${n}`,G=`${g}.${w}`;if(K.has(o))return{pk:$,fk:_};else if(K.has(G))return{pk:_,fk:$};if(n==="id"||n==="_id")return{pk:_,fk:$};else if(w==="id"||w==="_id")return{pk:$,fk:_};if(A===f)return{pk:_,fk:$};else if(g===f)return{pk:$,fk:_};throw Error(`Cannot determine pk/fk from condition: "${_} = ${$}"`)}buildRelations(_,$){let f={},K=new Set(this.knownForeignKeys);for(let[A,n]of Object.entries(_)){let[g,w]=n.split(/\s*=\s*/),{pk:o,fk:G}=this.identifyPkFk(g,w,$,K),[Y,q]=o.split("."),[P,m]=G.split(".");K.add(`${P}.${m}`);let j=this.tableDbMap?.[P]||this.defaultDbKey;f[A]={type:"1n",path:[j,P],pk:q,fk:m,as:A}}return this.knownForeignKeys=K,f}}function t(_,$){let f,K=_,A=_.toUpperCase().lastIndexOf(" WHERE ");if(A!==-1)f=_.substring(A+7).trim(),K=_.substring(0,A);let n=K.match(/SELECT\s+(.+?)\s+FROM\s+([\w\/]+)((?:\s+JOIN\s+.+)*)?/i);if(!n)throw Error("Invalid SELECT syntax");let g=n[1].trim(),w=n[2],o=n[3]||"",G=f?b(f):{},Y=__(g);if(o&&$?.defaultDbKey){let q=Q(o),m=new I($.defaultDbKey,$.tableDbMap).buildRelations(q,w),j=[$.defaultDbKey,w];return v("relation-find",[j,G,m,Y])}return v("find",[w,G,{},Y])}function Q(_){let $={},f=/\s+JOIN\s+([\w\/]+)(?:\s+AS\s+)?([\w\/]+)?\s+ON\s+([^\s]+)\s*=\s*([^\s]+)/gi,K;while((K=f.exec(_))!==null){let A=K[1],n=K[2]||A,g=`${K[3]} = ${K[4]}`;$[n]=g}return $}function __(_){if(_=_.trim(),_==="*")return{};let $=_.match(/\*\s+EXCLUDE\s+(.+)/i);if($)return{exclude:$[1].split(/\s*,\s*/)};return{select:_.split(/\s*,\s*/)}}function T(_){let $=_.match(/UPDATE\s+([\w\/]+)\s+SET\s+(.+)\s+WHERE\s+(.+)/i);if(!$)throw Error("Invalid UPDATE syntax");let f=$[1],K=d($[2]),A=b($[3]);return v("update",[f,A,K])}class l{parse(_,$){if(_=_.replace(/\s+/g," ").trim(),_.endsWith(";"))_=_.slice(0,-1);let f=_.split(/\s+/),K=f[0].toUpperCase();if(K==="SELECT")return t(_,$);else if(K==="INSERT")return k(_);else if(K==="UPDATE")return T(_);else if(K==="DELETE")return a(_);else if(K==="GET")return C(_);else if(K==="CREATE")return i(_);else if(K==="DROP")return z(_);else if(K==="EXISTS")return e(_);else throw Error("Unknown query: "+f[0])}}var J=l;function V(_,$){let{args:f,method:K}=_,A=f[0],n={db:$,d:{}},g={find:{options:f[2],searchOpts:f[3]},findOne:{searchOpts:f[2]},update:{updater:f[2]},updateOne:{updater:f[2]},add:{data:f[1]}};if(n.d={[K]:g[K]||{}},n.d[K].collection=A,K!=="add")n.d[K].search=f[1];return n}function M(_){let{args:$}=_;return{r:{path:$[0],search:$[1],relations:$[2],options:$[3],select:$[4],many:!0}}}function u(_,$=""){let f=[];for(let K in _)if(_.hasOwnProperty(K)){let A=_[K],n=$?`${$}.${K}`:K;if(typeof A==="object"&&A!==null&&!Array.isArray(A))f.push(...u(A,n).split(" ").filter((g)=>g.length>0));else if(Array.isArray(A))f.push(`${n}=${JSON.stringify(A)}`);else f.push(`${n}=${A}`)}return f.join(" ")}function p(_,$,f){if(!($ in _))return;_[f]=_[$],delete _[$]}function r(_){let $="";if(!("d"in _))return"Relation cannot be converted to VQLS";let f=_.d,K=Object.keys(f)[0],A=f[K],n=A.collection,g=K.replace("One","");if(g==="find");else if(g==="update")n="~"+n;else if(g==="remove")n="-"+n;else if(g==="add")n="+"+n;else if(K==="updateOneOrAdd")n="updateOneOrAdd "+n;if(K.endsWith("One"))n+="!";if(delete A.collection,p(A,"search","s"),p(A,"data","d"),p(A,"options","o"),p(A,"updater","u"),A.searchOpts?.select)A.select=A.searchOpts.select.reduce((o,G)=>{return o[G]=1,o},{}),delete A.searchOpts.select;p(A,"select","e");let w=u(A);return $+=`${_.db} ${n} ${w}`,$}var $_=new J;function y(_,$,f=!1){let K=$_.parse(_,{defaultDbKey:$}),A=K.method==="relation-find"?M(K):V(K,$);return f?r(A):A}var E=document.querySelector("#sql-input"),x=document.querySelector("#db-name"),s=document.querySelector("#translate-btn"),Z=document.querySelector("#vql-object"),c=document.querySelector("#vql-string"),R=document.querySelector("#copy-vql"),N=document.querySelector("#copy-string"),W=document.querySelector("#output-card"),X="",h="",S=document.querySelectorAll(".tab-link"),f_=document.querySelectorAll(".tab-pane");S.forEach((_)=>{_.addEventListener("click",()=>{S.forEach((f)=>f.classList.remove("active")),f_.forEach((f)=>f.classList.remove("active")),_.classList.add("active");let $=document.querySelector(`#${_.dataset.tab}`);if($)$.classList.add("active")})});function L(){let _=E.value.trim(),$=x.value.trim()||"db1";if(!_){Z.textContent="Please enter a SQL query.",c.textContent="",W.classList.add("hidden");return}try{let f=y(_,$,!1);X=JSON.stringify(f,null,2),Z.textContent=X,h=r(f),c.textContent=h,W.classList.remove("hidden")}catch(f){console.error("Translation error:",f);let K=f instanceof Error?f.message:"An unknown error occurred.";X=`Error: ${K}`,h=`Error: ${K}`,Z.textContent=X,c.textContent=h,W.classList.remove("hidden")}}s.addEventListener("click",L);function B(_){if(_.key==="Enter"&&!_.shiftKey)_.preventDefault(),s.click()}E.addEventListener("keydown",B);x.addEventListener("keydown",B);var D;function F(_){let $=_.closest(".result-box");if(!$)return;let f=$.querySelector(".copy-tooltip");if(!f)return;clearTimeout(D),f.classList.add("visible"),D=setTimeout(()=>{f.classList.remove("visible")},1500)}R.addEventListener("click",()=>{if(!X)return;navigator.clipboard.writeText(X),F(R)});N.addEventListener("click",()=>{if(!h)return;navigator.clipboard.writeText(h),F(N)});L();

//# debugId=1891F1E32DE0376B64756E2164756E21
//# sourceMappingURL=script.js.map
